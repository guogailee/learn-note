## 短链接原理

```
1.在浏览器输入 http://t.cn/RIB2PdD

2.DNS解析域名http://t.cn，向IP地址发送http get，查询短码RIB2PdD

3.http://t.cn服务器服务，查询短码对应的长URL

4.请求通过302重定向到长URL，比如http://baidu.com
```

## 何时302何时301

```
1.301永久重定向，302临时重定向
2.短地址一经生成是不会变化的
3.用301，服务器压力会小一些，但是不能统计短地址被点击的次数
4.用302，虽然增加了服务器压力，但是可以统计短地址被点击的次数
```

## 短链接的好处

- 短：微博、短信等平台字数有限制，太长的链接加不进去
- 安全：不暴露访问参数
- 便于统计
- 简洁

## 数据库设计

| 字段                  | 含义               |
| --------------------- | ------------------ |
| id                    |                    |
| url                   | 长链接(加索引)     |
| keyword               | 短链接码(唯一索引) |
| type                  | 类型:system/custom |
| date_create           | 创建时间           |
| date_update           | 更新时间           |
| 过期时间/业务标识/... |                    |

## 长链接转短链接

### 如何保证短链唯一

```
自增序列算法：
唯一id，经过某种规则，转换唯一为字符串

单表：数据库自增id
多库多表：全局唯一id，雪花算法，使用key做分表键
```

### 十进制转换为62位的字符串

```
从低位转换到高位，字符数会减少
10进制的1000转换为62进制是2Bi
```

```
如何防止行家破解短链接
BASE = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
1.打断BASE码的顺序
2.对id转换为二进制，每隔固定位数，插入一个随机字符串
```

## 分库分表

- 逻辑上的32库*32表，物理上根据实际情况部署
- 短链接hash后%32=库，短链接hash/32%32=表

## 引入缓存解决高并发

- 读缓存

  ```
  根据短链接查询长URL，redis k=短链接 v=长URL
  ```

- 写缓存

  ```
  业务方，自行请求完短链接服务，redis k=长URL，v=短链接
  ```

