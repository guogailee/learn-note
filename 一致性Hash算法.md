## Hash算法

```
hash(用户id)%服务器机器数->用来负载均衡

缺点：伸缩性差，当新增机器或者下线机器的时候，用户id与服务器的映射关系会大量失效，所以需要引入一致性Hash算法。
```

## 一致性Hash算法

```
hash(ip)%2的32次方->根据ip计算的hash值肯定会落到hash环上的某一个点

定位数据访问到相应服务器的算法：hash(ip)%2的32次方，确定此数据在环上的位置，从此位置沿环顺时针“行走”，第一台遇到的服务器就是其应该定位到的服务器

Hash环：0和2的32次方-1组成的圆环
```

## 一致性Hash算法的容错性和扩展性

```
一致性Hash算法对于节点的增减都只需重定位环空间中的一小部分数据，具有较好的容错性和可扩展性。
```

## Hash环的数据倾斜问题如何解决

```
问题：一致性Hash算法在服务节点太少时，容易因为节点分部不均匀而造成数据倾斜（被缓存的对象大部分集中缓存在某一台服务器上）问题

解决：解决方法是多加机器，但是加机器是有成本的，那么就加虚拟节点
虚拟节点NodeA#1 NodeA#2 NodeA#3->都映射到实际节点Node#A

ipA->ipA1\ipA2\ipA3->hash环点A1、hash环点A2、hash环点A3

实际数据仍旧是在那几台服务器，解决的是让数据均匀分布在几台服务器上。

均匀一致性hash的目标是如果服务器有N台，客户端的hash值有M个，那么每个服务器应该处理大概M/N个用户的。也就是每台服务器负载尽量均衡
```

## Redis集群中的一致性Hash算法

```
redis不使用一致性Hash算法会有什么问题：
第一当缓存服务器数量发生变化时，会引起缓存的雪崩，可能会引起整体系统压力过大而崩溃（大量缓存同一时间失效）。
第二当缓存服务器数量发生变化时，几乎所有缓存的位置都会发生改变。
```

## 参考资料

### [深入浅出一致性Hash原理](https://www.jianshu.com/p/e968c081f563)

### [Redis集群中的一致性Hash算法](https://blog.csdn.net/qq_21125183/article/details/90019034)