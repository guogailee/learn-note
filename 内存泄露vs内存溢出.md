## 内存泄露

```
申请使用完的内存没有释放，导致虚拟机不能再次使用该内存，此时这段内存就泄露了，因为申请者不用了，而又不能被虚拟机分配给别人用。
```

## 内存泄露的原因

```
无用对象A的生命周期比较短，已经没用了，被更长的对象B持有，得不到释放
```

## 如何解决内存泄露

- 使用List\Map等集合时候，在使用完成后赋值为null。
- 使用大对象时，在用完后赋值为null。
- 避免一些死循环等重复创建或对集合添加元素，撑爆内存
- 简洁数据结构，少用静态集合
- 及时的关闭打开的文件，socket句柄
- 多关注事件监听和回调，当不再使用的时候，注销掉

## 内存溢出OOM

```
申请的内存超出了JVM能提供的内存大小，此时称之为溢出。
```

## OOM的三种常见场景

- java堆内存溢出

  ```
  java.lang.OutOfMemoryError: Java heap space ------>java堆内存溢出，此种情况最常见，一般由于内存泄露或者堆的大小设置不当引起。对于内存泄露，需要通过内存监控软件查找程序中的泄露代码，而堆大小可以通过虚拟机参数-Xms,-Xmx等修改。
  ```

- java永久代溢出

  ```
  java.lang.OutOfMemoryError: PermGen space ------>java永久代溢出，即方法区溢出了，一般出现于大量Class或者jsp页面，或者采用cglib等反射机制的情况，因为上述情况会产生大量的Class信息存储于方法区。此种情况可以通过更改方法区的大小来解决，使用类似-XX:PermSize=64m -XX:MaxPermSize=256m的形式修改。另外，过多的常量尤其是字符串也会导致方法区溢出。
  ```

- JAVA虚拟机栈溢出

  ```
  java.lang.StackOverflowError ------> 不会抛OOM error，但也是比较常见的Java内存溢出。JAVA虚拟机栈溢出，一般是由于程序中存在死循环或者深度递归调用造成的，栈大小设置太小也会出现此种溢出。可以通过虚拟机参数-Xss来设置栈的大小。
  ```

## 如何解决OOM

```
通过dump出oom时的内存镜像，分析堆转存文件快照，调整jvm参数和代码优化。

设置JVM参数-XX:+HeapDumpOnOutOfMemoryError，设定当发生OOM时自动dump出堆信息。
```

