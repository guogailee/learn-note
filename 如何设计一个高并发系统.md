## 如何设计一个高并发系统？

### 一定是结合业务去设计的

- 并发：同一时刻有多少个请求在跑

- 为何需要设计高并发系统？

  ```
  单机数据库支撑到每秒并发两三千的时候，基本就快完了。如果瞬间承载每秒5000，8000，甚至上万的并发，一定会宕机。
  ```

- 如何设计？从请求最开始到最底层依次设计

  1. 系统拆分

     ```
     子系统分布式部署，系统间调用使用dubbo，子系统使用单独的数据库。
     ```

  2. 引入缓存

     ```
     大部分高并发的场景，都是读多写少，读的时候走缓存，redis轻轻松松单机几万的并发，所以考虑项目中，承载主要请求的读场景，怎么用缓存来抗高并发。
     ```

  3. 引入mq消息队列异步写

     ```
     仍旧有高并发写场景，如何设计呢？比如淘宝双11下单，mq单机抗几万并发。大量的写请求放入mq，排队慢慢玩，后边系统消费后慢慢写，控制在mysql承载范围内。
     
     为何不用redis承载写，redis是缓存，数据随时被LRU，数据格式无比简单，没有事务支持。
     ```

  4. 分库分表

     ```
     可能到了数据库层面，还是达不到抗高并发的要求。那么就数据库拆分为多个库，一个表拆分为多个表，比如订单轨迹拆分为N个表，根据订单号hash求在哪个表。
     
   表的数据量越小，sql性能越高
     ```

  5. 数据库读写分离
  
     ```
   大多数都是读多写少，所以数据库读写分离，读可以搞多个从库。
     ```

  6. 引入ElasticSearch
  
     ```
     ES是分布式的，可以随便扩容，解决高并发。
     所以一些简单的查询，统计，全文搜索，可以考虑用ES。
     ```

